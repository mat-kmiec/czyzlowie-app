<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="v1-create-synop-stations" author="mateusz kmiec">
        <createTable tableName="imgw_synop_stations">
            <column name="id" type="varchar(20)">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false" />
            </column>
            <column name="latitude" type="decimal(10,8)" />
            <column name="longitude" type="decimal(10,8)" />
            <column name="is_active" type="boolean" defaultValueBoolean="true" />
        </createTable>
    </changeSet>

    <changeSet id="v1-create-meteo-stations" author="mateusz kmiec">
        <createTable tableName="imgw_meteo_stations">
            <column name="id" type="varchar(20)">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false" />
            </column>
            <column name="latitude" type="decimal(10,8)">
                <constraints nullable="false" />
            </column>
            <column name="longitude" type="decimal(10,8)">
                <constraints nullable="false" />
            </column>
            <column name="is_active" type="boolean" defaultValueBoolean="true" />
        </createTable>
    </changeSet>

    <changeSet id="v1-create-hydro-stations" author="mateusz kmiec">
        <createTable tableName="imgw_hydro_stations">
            <column name="id" type="varchar(20)">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="varchar(100)">
                <constraints nullable="false" />
            </column>
            <column name="river" type="varchar(100)">
                <constraints nullable="false" />
            </column>

            <column name="province" type="varchar(100)" />

            <column name="latitude" type="decimal(10,8)" />

            <column name="longitude" type="decimal(10,8)" />

            <column name="is_active" type="boolean" defaultValueBoolean="true" />
        </createTable>
    </changeSet>

    <changeSet id="v1-create-synop-data" author="mateusz kmiec">
        <createTable tableName="imgw_synop_data">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="station_id" type="varchar(20)">
                <constraints nullable="false" foreignKeyName="fk_synop_data_station" referencedTableName="imgw_synop_stations" referencedColumnNames="id" />
            </column>
            <column name="measurement_date" type="date" />
            <column name="measurement_hour" type="integer" />
            <column name="temperature" type="decimal(4,1)" />
            <column name="wind_speed" type="integer" />
            <column name="wind_direction" type="integer" />
            <column name="relative_humidity" type="decimal(4,1)" />
            <column name="total_precipitation" type="decimal(5,2)" />
            <column name="pressure" type="decimal(6,1)" />
            <column name="created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP" />
        </createTable>
        <addUniqueConstraint tableName="imgw_synop_data" columnNames="station_id, measurement_date, measurement_hour" constraintName="uq_synop_measurement" />
    </changeSet>

    <changeSet id="v1-create-meteo-data" author="mateusz kmiec">
        <createTable tableName="imgw_meteo_data">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="station_id" type="varchar(20)">
                <constraints nullable="false" foreignKeyName="fk_meteo_data_station" referencedTableName="imgw_meteo_stations" referencedColumnNames="id" />
            </column>

            <column name="air_temp" type="decimal(4,1)" />
            <column name="air_temp_time" type="timestamp" />
            <column name="ground_temp" type="decimal(4,1)" />
            <column name="ground_temp_time" type="timestamp" />

            <column name="wind_direction" type="integer" />
            <column name="wind_avg_speed" type="decimal(4,1)" />
            <column name="wind_max_speed" type="decimal(4,1)" />
            <column name="wind_measurement_time" type="timestamp" />

            <column name="wind_gust_10min" type="decimal(4,1)" />
            <column name="wind_gust_10min_time" type="timestamp" />
            <column name="relative_humidity" type="decimal(4,1)" />
            <column name="relative_humidity_time" type="timestamp" />
            <column name="precipitation_10min" type="decimal(5,2)" />
            <column name="precipitation_10min_time" type="timestamp" />
            <column name="created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP" />
        </createTable>
    </changeSet>

    <changeSet id="v1-create-hydro-data" author="mateusz kmiec">
        <createTable tableName="imgw_hydro_data">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="station_id" type="varchar(20)">
                <constraints nullable="false" foreignKeyName="fk_hydro_data_station" referencedTableName="imgw_hydro_stations" referencedColumnNames="id" />
            </column>

            <column name="water_level" type="integer" />
            <column name="water_level_date" type="timestamp" />

            <column name="water_temperature" type="decimal(4,1)" />
            <column name="water_temperature_date" type="timestamp" />

            <column name="discharge" type="decimal(8,3)" />
            <column name="discharge_date" type="timestamp" />

            <column name="ice_phenomenon" type="integer" />
            <column name="ice_phenomenon_date" type="timestamp" />
            <column name="overgrowth_phenomenon" type="integer" />
            <column name="overgrowth_phenomenon_date" type="timestamp" />

            <column name="created_at" type="timestamp" defaultValueComputed="CURRENT_TIMESTAMP" />
        </createTable>
    </changeSet>

</databaseChangeLog>